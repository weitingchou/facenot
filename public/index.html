<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Facnot</title>

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/freelancer.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

				
				<div>
					<span style="float:left" class="fa fa-tint fa-lg"></span>				
					<a class="navbar-brand" href="#page-top">Facnot</a>
				</div>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li class="page-scroll">
                        <a href="#portfolio">your diaries</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#about">about us</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#contact">contact us</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    

    <!-- Portfolio Grid Section -->
    <section id="portfolio">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    </br>
                    <h2>Your Diaries</h2>
                    <hr class="star-primary">
                </div>
            </div>

<!--
            <div align="center" class="col-xs-5">
                <input type="text" class="form-control" id="storeName">
                <button type="button" class="btn btn-default btn-md" onclick="send_request('GET')"><i class="fa fa-cloud-upload"></i> Search</button>
            </div>
-->

            <form class="navbar-form text-center" id="formAnalysis" role="search" onsubmit="return false">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Please enter your user id." id="username">
                </div>
                <button type="button" class="btn btn-default" onclick="send_request('GET')"><span class="glyphicon glyphicon-search"></span></button>
            </form>
            <!--<p align="center">Please type your own id.</p>-->
                    <!--
                    <div align="center">
                            <img id="diaryPhoto" class="img-circle" src="" height="300" width="300" style="visibility:hidden"/>
                    </div>
                    -->
			
                <div>
                    <table id="resultTable"  align="center">
                        <tr>
                            <td><img class="img-circle" width="210px" height="210px" src="" id="testImg0" style="display:none"></td>
                            <td><img class="img-circle" width="210px" height="210px" src="" id="testImg1" style="display:none"></td>
                            <td><img class="img-circle" width="210px" height="210px" src="" id="testImg2" style="display:none"></td>
                            <td><img class="img-circle" width="210px" height="210px" src="" id="testImg3" style="display:none"></td>
                            <td><img class="img-circle" width="210px" height="210px" src="" id="testImg4" style="display:none"></td>
                        </tr>
                            
                        <tr style="vertical-align:top;">

                            <td><ul class="list-inline item-details" id="testDiary0" style="display:none"></ul></td>
                            <td><ul class="list-inline item-details" id="testDiary1" style="display:none"></ul></td>
                            <td><ul class="list-inline item-details" id="testDiary2" style="display:none"></ul></td>
                            <td><ul class="list-inline item-details" id="testDiary3" style="display:none"></ul></td>
                            <td><ul class="list-inline item-details" id="testDiary4" style="display:none"></ul></td>						
                        </tr>

                    </table>
                </div>			
                <div>
                        <div align="center">				
                                <ul class="list-inline item-details" id="resultPhoto" />
                        </div>
                        </br>			
                        <div align="center">				
                                <ul class="list-inline item-details" id="resultText" />
                        </div>
                </div>			
			
            <hr style="height:2px;width:50%;background-color:black"/>	
            <div align="center" style="color:#2C3E50;font-size:large">
                    <i><strong>Please <a style="color:#d58d95;" href="#contact">contact us</a> to send you the invitation to download the application.</strong></i>
            </div>			

        </div>
    </section>

    <!-- About Section -->
    <section class="success" id="about">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>About us</h2>
                    <hr class="star-light">
                </div>
            </div>
            <div class="row" align="center">
                <div class="col-lg-4 col-lg-offset-2">
                    <p>James Lei (jameslei@tw.ibm.com) GBS </p>
                </div>
                <div class="col-lg-5">
                    <p>Vivian Hung (vivianth@tw.ibm.com) GBS </p>
                </div>
                <div class="col-lg-4 col-lg-offset-2">
                    <p>Stone Chiu (spcchiu@tw.ibm.com) CDL </p>
                </div>
                <div class="col-lg-5">
                    <p>Richard Chou (richchou@tw.ibm.com) CDL</p>
                </div>
                <div class="col-lg-8 col-lg-offset-2 text-center">
                    <a href="#" class="btn btn-lg btn-outline">
                        <i class="fa fa-keyboard-o"></i> Try your diaries
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>Contact Us</h2>
                    <hr class="star-primary">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                    <!-- To configure the contact form email address, go to mail/contact_me.php and update the email address in the PHP file on line 19. -->
                    <!-- The form should work on most web servers, but if the form is not working you may need to configure your web server differently. -->
                    <form name="sentMessage" id="contactForm" novalidate>
                        <div class="row control-group">
                            <div class="form-group col-xs-12 floating-label-form-group controls">
                                <label>Name</label>
                                <input type="text" class="form-control" placeholder="Name" id="name" required data-validation-required-message="Please enter your name.">
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="row control-group">
                            <div class="form-group col-xs-12 floating-label-form-group controls">
                                <label>Email Address</label>
                                <input type="email" class="form-control" placeholder="Email Address" id="email" required data-validation-required-message="Please enter your email address.">
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>                       
                        <div class="row control-group">
                            <div class="form-group col-xs-12 floating-label-form-group controls">
                                <label>Message</label>
                                <textarea rows="5" class="form-control" placeholder="Message" id="message" required data-validation-required-message="Please enter a message."></textarea>
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <br>
                        <div id="success"></div>
                        <div class="row">
                            <div class="form-group col-xs-12">
                                <button type="submit" class="btn btn-success btn-lg">Send</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="text-center">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4">
                        <h3>Location</h3>
                        <!--<p>台北市松仁路7號3樓</p>-->
                        <p>3F., No.7, Songren Rd., Taipei City, Taiwan</p>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>Around the Web</h3>
                        <ul class="list-inline">
                            <li>
                                <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-facebook"></i></a>
                            </li>
                            <li>
                                <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-google-plus"></i></a>
                            </li>
                            <li>
                                <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
                            </li>
                            <li>
                                <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-linkedin"></i></a>
                            </li>
                            <li>
                                <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-dribbble"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>About Facnot</h3>
                        <p>We are from Taiwan!</a></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; Facnot 2015
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visble-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>
    <script src="js/watermarkinput.js"></script>
    <script>
		/*
        jQuery(function($){
           //$("#username").Watermark("Type the store name you want to search.");
           $("#username").Watermark("Please type your own id.");
        });
		*/
    </script>

    <!-- Bootstrap Core JavaScript -->
    <script>

        var myApp;
        var root = "http://facnot.mybluemix.net/";
        //var root = "/";
		
        myApp = myApp || (function () {
            var pleaseWaitDiv = $('<div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Processing...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');
            return {
                showPleaseWait: function() {
                    pleaseWaitDiv.modal('show');
                },
                hidePleaseWait: function () {
                    pleaseWaitDiv.modal('hide');
                },

            };
        })();

        function send_request(method)
        {
            //myApp.showPleaseWait();
            waitingDialog.show('Loading', {dialogSize: 'sm', progressType: 'success'});            
          
            /*
            */
            setTimeout(function(){ 
							
                var username = document.getElementById("username").value;
                //console.log("send_request");
				
                var request = null;
				
                var url = root + "api/" + username + "/diaries"				
                request = new XMLHttpRequest();

                /*
                request.onreadystatechange=function(){
                    
                    if (request.status === 200) {
                      console.log('in callback: '+ request.responseText);
                      //waitingDialog.hide();
                      get_result(JSON.parse(request.responseText));
                    }
                }
                */

                request.open(method, url, false);
                request.send(null);

                
				
                if (request.status === 200) {                  
                  $('#resultText').empty();
                  reset_layout();
				  
                  get_ids(username,JSON.parse(request.responseText));
                  waitingDialog.hide();
                }
                else{
                  
                  $('#resultText').empty();
                  $('#resultText').append('<h5>User is not found.</h5>');
                  waitingDialog.hide();
                  //myApp.hidePleaseWait();
                }
				
            }, 500);


            //waitingDialog.hide();
            //get_result(JSON.parse(request.responseText));
        }
        function reset_layout(){

            for(var index=0;index<5;index++){

                var imageId = "testImg" + index
                var diaryId = "testDiary" + index
                document.getElementById(imageId).src = "";
                document.getElementById(imageId).style.display = "none";

                $('#'+diaryId).empty();
                document.getElementById(diaryId).style.display = "none";				
            }
        }

        function get_ids(username,json){
		    
            var index = 0;
            var length = json.result.length;

            var internvalId = setInterval(function(){

                if(length==0){
                    clearInterval(internvalId);;
                    $('#resultText').append('<h5>Empty Diaries.</h5>');
                }
                else if(index>=length||index>=5){
                    clearInterval(internvalId);;
                }
                else{
                    var id = json.result[index].id;
                    //console.log("id: " + id);
                    get_photo(username,id,index);
                    get_result(username,id,index);

                    index++;
                }
            }, 100 );
        };
		
        function get_photo(username,id,index){			
                var url = root + "api/" + username + "/diaryPhoto/" + id
                
                var request = new XMLHttpRequest();

                request.open('GET', url, true);
                request.responseType = "arraybuffer";

                request.onload = function (oEvent) {
                  var arrayBuffer = request.response; // Note: not oReq.responseText
                  if (arrayBuffer) {
                        var byteArray = new Uint8Array(arrayBuffer);
                                                        
                        var imageId = "testImg" + index
                        document.getElementById(imageId).src = "data:image/png;base64," + base64ArrayBuffer(arrayBuffer);
                        document.getElementById(imageId).style.display = "block";
                        
                        //document.getElementById("diaryPhoto").src = "data:image/png;base64," + base64ArrayBuffer(arrayBuffer);	
                        //document.getElementById("diaryPhoto").style.visibility = "visible";
                        
                        tr = $('<li>');
                        tr.append('<img class="img-circle" src="data:image/png;base64,' + base64ArrayBuffer(arrayBuffer) + '"height="210" width="210"/></li>');				
                        
                        //$('#resultPhoto').append(tr);
                  }
                };
                
                request.send(null);
        };
		
        function get_result(username,id,index){
                //var theUrl = "http://facnot.mybluemix.net/api/" + username + "/diary/" + id
                var url = root + "api/" + username + "/diary/" + id
                var request = new XMLHttpRequest();

                request.open('GET', url, true);

                request.onload = function (oEvent) {
                        
                        var json =JSON.parse(request.responseText); // Note: not oReq.responseText
                        json = json.result;
                        
                        //console.log("json: " + JSON.stringify(json));
                        
                        //var date = new Date('2010-10-11T00:00:00+05:30');
                        var date = new Date(json.date);
                        
                        json.date = (date.getMonth() + 1) + '/' + date.getDate() + '/' +  date.getFullYear();				
                        
                        var diaryId = "testDiary" + index
                        
                        //document.getElementById(diaryId).src = "data:image/png;base64," + base64ArrayBuffer(arrayBuffer);
                        
                        tr = $('<li style="display:inline-block; vertical-align:top;">');				 
       
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Date:   ' + '</strong></td><td width="190px"><h7>' + json.date + '</h7></td></tr>');
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Diary:   ' + '</strong></td><td width="190px"><h7>' + json.content + '</h7></td></tr>');
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Age:   ' + '</strong></td><td width="190px"><h7>' + json.analysis.age + '</h7></td></tr>');				
                        $('#'+diaryId).empty();
                        $('#'+diaryId).append(tr);
                        
                        document.getElementById(diaryId).style.display = "block";				
                        /*
        tr = $('<li>');
        tr.append("<h5>Date: <strong><a>" + json.date + "</a></strong></h5></li>");
        tr.append("<li><h5>Content: <strong><a>" + json.content + "</a></strong></h5></li>");
        tr.append("<li><h5>Age: <strong><a>" + json.analysis.age + "</a></strong></h5></li>");
                        
                        $('#resultText').append(tr);
                        */
                        
                        /*
                        tr = $('<li>');				
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Date:   ' + '</strong></td><td width="190px"><h7>' + json.date + '</h7></td></tr>');
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Diary:   ' + '</strong></td><td width="190px"><h7>' + json.content + '</h7></td></tr>');
                        tr.append('<tr align="left"><td width="20px" style="color:#ec8c94;"><strong>' + 'Age:   ' + '</strong></td><td width="190px"><h7>' + json.analysis.age + '</h7></td></tr>');				
                        
                        $('#resultText').append(tr);
                        */
                };
                
                request.send(null);
		
                //buildHtmlTable(dishes)
        }

        // Builds the HTML Table out of myList.
        function buildHtmlTable(dishes) {
            var columns = addAllColumnHeaders(dishes);

            for (var i = 0 ; i < dishes.length ; i++) {
                var row$ = $('<tr/>');
                for (var colIndex = 0 ; colIndex < columns.length ; colIndex++) {
                    var cellValue = dishes[i][columns[colIndex]];

                    if (cellValue == null) { cellValue = ""; }

                    row$.append($('<td/>').html(cellValue));
                }
                $("#recommendTable").append(row$);
            }
        }

        // Adds a header row to the table and returns the set of columns.
        // Need to do union of keys from all records as some records may not contain
        // all records

        function addAllColumnHeaders(dishes)
        {
            var columnSet = [];
            var headerTr$ = $('<tr/>');

            for (var i = 0 ; i < dishes.length ; i++) {
                var rowHash = dishes[i];
                for (var key in rowHash) {
                    if ($.inArray(key, columnSet) == -1){
                        columnSet.push(key);
                        headerTr$.append($('<th/>').html(key));
                    }
                }
            }
           $("#recommendTable").append(headerTr$);

            return columnSet;
        }

    </script>

	<script src="js/base64.js"></script>
    <script src="js/bootstrap-waitingfor.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/bootbox.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
	
    <script src="js/classie.js"></script>
    <script src="js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/freelancer.js"></script>

</body>

</html>
